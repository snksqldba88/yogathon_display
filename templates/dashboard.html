<!DOCTYPE html>
<html>
<head>
<title>Ultimate Marathon Dashboard</title>

<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body{font-family:Segoe UI,sans-serif;background:#F4F6F7;margin:0;padding:10px}
.container{display:flex;flex-wrap:wrap}
.left,.right{padding:10px;box-sizing:border-box}
.left{width:50%}
.right{width:50%}

@media(max-width:900px){
  .left,.right{width:100%}
}

.slot-block{background:#fff;padding:12px;border-radius:10px;margin-bottom:10px}
.curr{background:#BDD7EE}

.slot-title{font-size:20px;font-weight:bold}
.lead{font-size:22px;font-weight:bold}
.support{font-size:18px}

.clock{font-size:30px;font-weight:bold;margin-bottom:10px}

.instructions{background:#fff;padding:12px;border-radius:10px;margin-top:10px}

#qr{width:160px}

.total-count{font-size:42px;color:green;font-weight:bold;text-align:center;margin-top:10px}
</style>
</head>

<body>

<div class="container">

<!-- LEFT -->
<div class="left">

<iframe width="100%" height="550"
src="https://www.youtube.com/embed/{{youtube_id}}?autoplay=1&mute=1&loop=1&playlist={{youtube_id}}"
allow="autoplay; encrypted-media" allowfullscreen></iframe>

<div style="text-align:center;margin-top:15px">
<div style="font-size:22px;font-weight:bold">Total Surya Namaskar Count</div>
<div class="total-count" id="total_count">{{total_count}}</div>
</div>

</div>

<!-- RIGHT -->
<div class="right">

<div class="clock" id="clock"></div>

<div style="display:flex;justify-content:space-between">

<div style="width:65%">

<div class="slot-block">
<div class="slot-title">Previous Slot (<span id="prev_time">{{prev.time}}</span>)</div>
<div class="lead" id="prev_lead">{{prev.lead}}</div>
<div class="support" id="prev_support">{{prev.support}}</div>
</div>

<div class="slot-block curr">
<div class="slot-title">Current Slot (<span id="curr_time">{{curr.time}}</span>)</div>
<div class="lead" id="curr_lead">{{curr.lead}}</div>
<div class="support" id="curr_support">{{curr.support}}</div>
</div>

<div class="slot-block">
<div class="slot-title">Next Slot (<span id="next_time">{{next.time}}</span>)</div>
<div class="lead" id="next_lead">{{next.lead}}</div>
<div class="support" id="next_support">{{next.support}}</div>
</div>

</div>

<div style="width:30%;text-align:center">
<img id="qr" src="/static/{{qr_path}}">
</div>

</div>

<div class="instructions">
<h3>Instructions</h3>
<ol>
<li>Keep your video ON.</li>
<li>Start only when your slot begins.</li>
<li>Wait for previous participant.</li>
<li>Scan QR & submit your count.</li>
</ol>
</div>

</div>

</div>

<audio id="beep">
<source src="/static/beep.mp3" type="audio/mpeg">
</audio>

<script>
let lastSlot = -1;

function updateClock(){
  const now=new Date();
  document.getElementById("clock").innerText =
     "Current Time: " + now.toLocaleTimeString();
}

setInterval(updateClock,1000);
updateClock();

function refreshData(){
  fetch("/data")
    .then(r=>r.json())
    .then(d=>{

      document.getElementById("prev_time").innerText = d.prev.time;
      document.getElementById("prev_lead").innerText = d.prev.lead;
      document.getElementById("prev_support").innerText = d.prev.support;

      document.getElementById("curr_time").innerText = d.curr.time;
      document.getElementById("curr_lead").innerText = d.curr.lead;
      document.getElementById("curr_support").innerText = d.curr.support;

      document.getElementById("next_time").innerText = d.next.time;
      document.getElementById("next_lead").innerText = d.next.lead;
      document.getElementById("next_support").innerText = d.next.support;

      document.getElementById("total_count").innerText = d.total;

      if(d.slot_index !== lastSlot){
        document.getElementById("beep").play();
        lastSlot = d.slot_index;
      }

    }).catch(err=>console.log("Auto refresh error:",err));
}

setInterval(refreshData,5000);
</script>

</body>
</html>
